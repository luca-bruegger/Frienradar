<ion-content fullscreen="true" scroll-y="false">
  <ion-grid class="container-grid">
    <ion-row style="flex: 1; align-content: center">
      <ion-col sizeXl="4" offsetXl="4" class="ion-no-padding ion-padding-horizontal">
        <ion-card color="light" class="ion-no-margin">
          <ion-card-header>
            <ion-card-title color="primary">
              {{isRegister ? 'Registrieren' : 'Anmelden'}}
            </ion-card-title>
            <ion-card-subtitle>
              {{isRegister ? 'Neues Konto erstellen' : 'Mit bestehendem Konto anmelden'}}
            </ion-card-subtitle>
          </ion-card-header>
          <form (submit)="signInUser()">
            <ion-card-content class="ion-no-padding" *ngIf="!loginInProgress">
              <div [formGroup]="formGroup" class="ion-margin-bottom ion-padding-horizontal">
                <div *ngIf="isRegister">
                  <app-profile-picture-select [profilePicture]="profilePicture" (profilePictureChange)="setProfilePicture($event)"></app-profile-picture-select>
                  <ng-container *ngFor="let validation of formMessages.profilePicture">
                    <div class="error-message" style="text-align: center; padding-left: 0"
                         *ngIf="displayFormErrorByName('profilePicture', validation.type)">
                      {{ validation.message }}
                    </div>
                  </ng-container>
                  <ion-item color="light">
                    <ion-label position="stacked">Echter Name</ion-label>
                    <ion-input formControlName="name" placeholder="Vollständiger Name..." maxlength="50" required="true" autocorrect="true"></ion-input>
                    <ng-container *ngFor="let validation of formMessages.name">
                      <ion-note slot="error" *ngIf="displayFormErrorByName('name', validation.type)">
                        {{ validation.message }}
                      </ion-note>
                    </ng-container>
                  </ion-item>
                </div>
                <ion-item color="light">
                  <ion-label position="floating">Email Adresse</ion-label>
                  <ion-input formControlName="email" type="email" email="true" maxlength="50" required="true"
                             autocorrect="true"></ion-input>
                  <ng-container *ngFor="let validation of formMessages.email">
                    <ion-note slot="error" *ngIf="displayFormErrorByName('email', validation.type)">
                      {{ validation.message }}
                    </ion-note>
                  </ng-container>
                </ion-item>
                <ion-item color="light">
                  <ion-label position="floating">Passwort</ion-label>
                  <ion-input formControlName="password" type="password" maxlength="50" required="true"
                             autocorrect="true"></ion-input>
                  <ng-container
                    *ngFor="let validation of isRegister ? formMessages.passwordRegister : formMessages.passwordLogin">
                    <ion-note slot="error" *ngIf="displayFormErrorByName('password', validation.type)">
                      {{ validation.message }}
                    </ion-note>
                  </ng-container>
                </ion-item>
                <div *ngIf="isRegister" style="width: 100%; padding-left: 20px; display: block">
                  <password-strength-meter [password]="formGroup.value.password"
                                           (strengthChange)="this.strength = $event"></password-strength-meter>
                </div>
                <div *ngIf="isRegister">
                  <div class="terms-checkbox">
                    <div class="ion-padding checkbox-wrapper">
                      <ion-checkbox slot="start" formControlName="acceptTerms"></ion-checkbox>
                    </div>
                    <div>
                      <ion-label class="ion-text-wrap" style="font-size: 1rem">Ich akzeptiere die <a
                        href="https://frienradar.com/privacy/">Datenschutzerklärung</a>
                        und die <a href="https://frienradar.com/terms-conditions/">Nutzungsbedinungen</a></ion-label>
                    </div>
                  </div>
                  <ng-container
                    *ngFor="let validation of isRegister ? formMessages.acceptTerms : formMessages.acceptTerms">
                    <div class="error-message"
                         *ngIf="formGroup.get('acceptTerms').hasError(validation.type) && (formGroup.get('acceptTerms').dirty || formGroup.get('acceptTerms').touched)">
                      {{ validation.message }}
                    </div>
                  </ng-container>
                </div>
              </div>
              <ion-grid>
                <ion-row class="ion-align-items-center">
                  <ion-col size="12" class="ion-text-center">
                    <ion-button color="secondary" class="ion-margin-bottom" (click)="signInUser()">
                      {{isRegister ? 'Registrieren' : 'Anmelden'}}
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-card-content>
            <ion-card-content *ngIf="loginInProgress">
              <div
                style="display: flex; flex-direction: row; text-align: center; align-items: center; gap: 10px; justify-content: center; height: 70px">
                <ion-spinner name="crescent" style="vertical-align: center"></ion-spinner>
                <p>Du wirst angemeldet...</p>
              </div>
            </ion-card-content>
          </form>
        </ion-card>
      </ion-col>
      <ion-col size="12" sizeXl="4" offsetXl="4" class="ion-text-center ion-padding">
        <ion-button *ngIf="isRegister" [disabled]="loginInProgress" color="bright" expand="block"
                    (click)="changeLoginType(false)">
          <small>Hast du bereits ein Konto?</small>
        </ion-button>
        <ion-button *ngIf="!isRegister" [disabled]="loginInProgress" color="bright" expand="block"
                    (click)="changeLoginType(true)">
          <small>Noch kein Konto?</small>
        </ion-button>
      </ion-col>
      <ion-col *ngIf="!isRegister" size="12" class="ion-text-center">
        <ion-button color="secondary" fill="clear" [disabled]="loginInProgress" (click)="resetPassword()">
          <small>Passwort zurücksetzen</small>
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
